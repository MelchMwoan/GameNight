@inject HttpClient HttpClient
@using Domain
@using Infrastructure.EF
@using System.Text
@using System.Text.Json
@using System.Net.Http
@model dynamic

@{
	ViewBag.Title = "Night Details";
}

<h2>@Model.Night.Title</h2>
@{
	var user = this.User;
	List<Person> players = Model.Night.Players;
	<span>@Model.Night.Organisator?.Email</span>
	<br/>
	<br/>

	@if (@User.Identity.Name != null)
	{
		<span>Hello @User.Identity.Name</span>
		if (@Model.Night.Organisator.Email == @User.Identity.Name)
		{
			<br/>
			<span>Own night</span>
		}
		else
		{
			if (players.FindAll(person => person.Email == @User.Identity.Name).Any())
			{
				<br/>
				<span>Joined night</span>
				<form method="post" asp-controller="Night" asp-action="LeaveNight">
					<input type="hidden" name="nightId" value="@Model.Night.Id"/>
					<button id="leaveNightBtn">Leave Night</button>
				</form>
			}
			else
			{
				<br/>
				<span>@Model.Night</span>
				<form method="post" asp-controller="Night" asp-action="JoinNight">
					<input type="hidden" name="nightId" value="@Model.Night.Id"/>
					<button id="joinNightBtn">Join Night</button>
				</form>
			}
		}
	}
	else
	{
		<span>Login bitch</span>
	}
}